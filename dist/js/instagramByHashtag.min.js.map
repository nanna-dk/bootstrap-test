{"version":3,"sources":["instagramByHashtag.js"],"names":["$","document","ready","it","$cachedWidth","prop","$wrapper","$container","find","$isMobile","attr","window","matchMedia","$hash","toLowerCase","trim","$batchClass","$number","$numbers","parseInt","$loading","getInstagramByHash","hashtag","empty","ajax","url","type","dataType","data","success","hide","batch","entry","entry_data","TagPage","graphql","edge_hashtag_to_media","edges","each","i","v","img","node","thumbnail_src","shortcode","append","$images","k","e","addClass","appendTo","wrapInner","error","xhr","status","console","log","responseText","complete","rotator","fn","options","extend","blocks","speed","fadeSpeed","rotate","element","len","length","index","fadeIn","timer","setInterval","block","eq","clearInterval","fadeOut","this","elem","css","onresize","$newWidth","show","clearTimeout","setTimeout","jQuery"],"mappings":"CAKA,SAAWA,GACT,aACAA,EAAEC,UAAUC,MAAM,WAChB,IAyGIC,EAzGAC,EAAeJ,EAAE,QAAQK,KAAK,eAC9BC,EAAWN,EAAE,eACbO,EAAaD,EAASE,KAAK,aAE3BC,EAAwD,aAApCH,EAASI,KAAK,qBAA4F,IAArDC,OAAOC,WAAW,sBAA6B,QACxHC,OAAkD,IAAlCP,EAASI,KAAK,gBAAmC,KAAOJ,EAASI,KAAK,gBAAgBI,cAAcC,OACpHC,EAAc,QACdC,EAAUX,EAASI,KAAK,eAIxBQ,EAAYP,OAAOC,WAAW,sBAA6B,QAAI,EAAIO,SAASF,EAAS,IACrFG,EAAWd,EAASE,KAAK,eAE7B,SAASa,EAAmBC,GAE1B,IAAkB,IAAdb,IAGJF,EAAWgB,QACPD,GAAS,CAGXtB,EAAEwB,KAAK,CACLC,IAFS,mFAGTC,KAAM,OACNC,SAAU,OACVC,KAAM,CACJN,QAAST,GAEXgB,QAAS,SAAUD,GAEjBR,EAASU,OACT,IAOIC,EAPAC,EAAQJ,EAAKK,WAAWC,QAAQ,GAAGC,QAAQb,QAAQc,sBAAsBC,MAC7ErC,EAAEsC,KAAKN,EAAO,SAAUO,EAAGC,GACzB,IAAIC,EAAMT,EAAMO,GAAGG,KAAKC,cACpBC,EAAYZ,EAAMO,GAAGG,KAAKE,UAE9B,OADArC,EAAWsC,OAAO,wCAA0CD,EAAY,+CAAiDH,EAAM,UAAYnB,EAAU,UAC9IiB,EAAIO,KAGb9C,EAAE,IAAKO,GAAY+B,KAAK,SAAUS,EAAGC,GAC/BD,EAAI7B,GAAY,IAClBa,EAAQ/B,EAAE,UAAUiD,SAASjC,GAAakC,SAAS3C,IAErDwB,EAAMc,OAAOG,KAGfhD,EAAE,IAAMgB,GAAamC,UADV,8BAGbC,MAAO,SAAUC,EAAKC,EAAQF,GAC5BG,QAAQC,IAAIH,EAAII,eAElBC,SAAU,WACRnD,EAAWoD,cAMnB3D,EAAE4D,GAAGD,QAAU,SAAUE,GACvBA,EAAU7D,EAAE8D,OAAO,CACjBC,OAAQzD,EAASE,KAAK,IAAMQ,GAC5BgD,MAAO,IACPC,UAAW,KACVJ,GACH,IAOIK,EAAS,SAAUC,GACrB,IAAIJ,EAAS/D,EAAE6D,EAAQE,OAAQI,GAC7BC,EAAML,EAAOM,OACbC,GAAS,EACXP,EAAOQ,OAAOV,EAAQI,WACtB,IAAIO,EAAQC,YAAY,WACtBH,IACA,IAAII,EAAQX,EAAOY,GAAGL,GAClBA,GAASF,IACXQ,cAAcJ,GACdN,EAAOC,IAELO,EAAMJ,SAAYF,EAAM,GAC1BM,EAAMG,QAAQhB,EAAQI,YAEvBJ,EAAQG,QAEb,OAAOc,KAAKxC,KAAK,WACf,IAzBwB6B,EACpBG,EAwBAS,EAAO/E,EAAE8E,MAzBWX,EA0BdY,EAzBNT,EAAQtE,EAAE6D,EAAQE,OAAQI,GAASE,OACvCrE,EAAE6D,EAAQE,OAAQI,GAAS7B,KAAK,WAC9BgC,IACAtE,EAAE8E,MAAME,IAAI,SAAUV,KAuBxBJ,EAAOa,MAKPlE,GACFQ,EAAmBR,GAQrBF,OAAOsE,SAAW,WAChB,IAAIC,EAAYlF,EAAE,QAAQK,KAAK,eAC3B6E,IAAc9E,IAChBgB,EAAS+D,OACTC,aAAajF,GACbA,EAAKkF,WAAW,WACdhE,EAAmBR,IAClB,KACHT,EAAe8E,MAtHvB,CA0HGI","file":"instagramByHashtag.min.js","sourcesContent":["/* NEL, KU KOM\n * Script to fetch images from Instagram by hashtag. Based on scrapung - may stop working at any time.\n * Needs html like this: <div id=\"instagram_hash\" data-hashtag=\"blivstuderendepÃ¥Kinastudier\" data-images=\"6\" data-hidemobile=\"false\" class=\"instagram-box\"></div>\n * data-hashtag represents the hashtag to search for.\n * data-images pepresents the number of images to display at a time. */\n(function ($) {\n  'use strict';\n  $(document).ready(function () {\n    var $cachedWidth = $('body').prop('clientWidth');\n    var $wrapper = $('#ig_hashtag');\n    var $container = $wrapper.find(\"#imageBox\");\n    // $isMobile must be true or null and in mobile view to be true\n    var $isMobile = (typeof $wrapper.attr(\"data-hidemobile\") == null || true && (window.matchMedia('(max-width: 767px)').matches) === true) ? true : false;\n    var $hash = (typeof $wrapper.attr(\"data-hashtag\") === 'undefined') ? null : $wrapper.attr(\"data-hashtag\").toLowerCase().trim();\n    var $batchClass = \"batch\";\n    var $number = $wrapper.attr(\"data-images\");\n    //$number = $number.toString();\n    var $images = 12;\n    // We always display 2 images on mobile\n    var $numbers = (window.matchMedia('(max-width: 480px)').matches) ? 2 : parseInt($number, 10);\n    var $loading = $wrapper.find(\".ku-loading\");\n\n    function getInstagramByHash(hashtag) {\n      // Fetch Instagram images by hashtag\n      if ($isMobile === true) {\n        return //Don't run on mobile\n      }\n      $container.empty();\n      if (hashtag) {\n        // This php script is scraping content from the Instagram tags page and serving it as json:\n        var $url = \"https://cms.secure.ku.dk/instacms/instagramByUserOrTag/instagramScrapeToJson.php\";\n        $.ajax({\n          url: $url,\n          type: 'post',\n          dataType: \"json\",\n          data: ({\n            hashtag: $hash\n          }),\n          success: function (data) {\n            //console.log(data);\n            $loading.hide();\n            var entry = data.entry_data.TagPage[0].graphql.hashtag.edge_hashtag_to_media.edges;\n            $.each(entry, function (i, v) {\n              var img = entry[i].node.thumbnail_src;\n              var shortcode = entry[i].node.shortcode;\n              $container.append('<a href=\"https://www.instagram.com/p/' + shortcode + ' \" target=\"_blank\" rel=\"noopener\"><img src=\"' + img + '\" alt=\"' + hashtag + '\"></a>');\n              return i < $images - 1;\n            });\n            var batch;\n            $('a', $container).each(function (k, e) {\n              if (k % $numbers == 0) {\n                batch = $('<div/>').addClass($batchClass).appendTo($container);\n              }\n              batch.append(e);\n            });\n            var wrap = \"<div class='inner'></div>\";\n            $('.' + $batchClass).wrapInner(wrap);\n          },\n          error: function (xhr, status, error) {\n            console.log(xhr.responseText);\n          },\n          complete: function () {\n            $container.rotator();\n          }\n        });\n      }\n    }\n\n    $.fn.rotator = function (options) {\n      options = $.extend({\n        blocks: $wrapper.find('.' + $batchClass),\n        speed: 6000,\n        fadeSpeed: 800\n      }, options);\n      var setZIndex = function (element) {\n        var index = $(options.blocks, element).length;\n        $(options.blocks, element).each(function () {\n          index--;\n          $(this).css('zIndex', index);\n        });\n      };\n      var rotate = function (element) {\n        var blocks = $(options.blocks, element),\n          len = blocks.length,\n          index = -1;\n        blocks.fadeIn(options.fadeSpeed);\n        var timer = setInterval(function () {\n          index++;\n          var block = blocks.eq(index);\n          if (index == len) {\n            clearInterval(timer);\n            rotate(element);\n          }\n          if (block.index() != (len - 1)) {\n            block.fadeOut(options.fadeSpeed);\n          }\n        }, options.speed);\n      };\n      return this.each(function () {\n        var elem = $(this);\n        setZIndex(elem);\n        rotate(elem);\n      });\n    };\n\n    // Init script\n    if ($hash) {\n      getInstagramByHash($hash);\n    } else {\n      //console.log('Add Instagram hashtag to search for and number of images to display using data-hashtag=\"\" and data-images=\"\" on the container');\n    }\n\n    //On resize, wait and reload function\n    var it;\n\n    window.onresize = function () {\n      var $newWidth = $('body').prop('clientWidth');\n      if ($newWidth !== $cachedWidth) {\n        $loading.show();\n        clearTimeout(it);\n        it = setTimeout(function () {\n          getInstagramByHash($hash);\n        }, 200);\n        $cachedWidth = $newWidth;\n      }\n    };\n  });\n})(jQuery);\n"]}